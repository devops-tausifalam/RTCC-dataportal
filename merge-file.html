<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <!-- avoid resizing of styles -->
    <meta
      name="viewport"
      content="width=1024, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Service Record Form v3</title>
    <!-- fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap"
      rel="stylesheet"
    />
    <!-- icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/all.min.css"
      integrity="sha512-5Hs3dF2AEPkpNAR7UiOHba+lRSJNeM2ECkwxUIxC1Q/FLycGTbNapWXB4tP889k5T5Ju8fs4b1P5z/iB4nMfSQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <!-- embedded styles -->
    <style>
      * {
        font-family: "Open Sans", sans-serif;
        margin: 0;
        padding: 0;
      }

      html,
      body {
        margin: 0;
        padding: 0;
        width: 100%;
        box-sizing: border-box;
      }
      body {
        background: url("https://lectura.press/media-storage/press_releases/thumb_big_m_retina/hx160a_l(389).jpg");
        background-repeat: no-repeat; /* Prevent image repetition */
        background-size: cover; /* Make the image cover the entire screen */
        background-attachment: fixed; /* Keep the background fixed during scrolling */
        background-position: center center; /* Center the image */
        width: 100vw;
        overflow-x: hidden;
      }
      div.flex-wrapper {
        width: 100%;
        display: flex;
        flex: 1 1;
        flex-direction: column;
        background-color: rgba(0, 0, 0, 0.7);
      }
      p.notification {
        text-align: center;
        color: #cccccc;
        margin: 5px auto;
        text-decoration: underline;
      }
      /* main.master-container {
  box-sizing: border-box;
  background-color: rgba(0,0,0,0.7);
  margin: 0 auto;
  border-radius: 5px;
  height: 100%;
} */
      main.master-container div.container {
        display: grid;
        grid-template-columns: 360px 2fr; /* Two columns: fixed left, flexible right */
        grid-template-rows: auto auto; /* Two rows for stacking */

        width: 100%; /* Full width */
        box-sizing: border-box;
      }
      .left {
        grid-column: 1; /* Left column */
        grid-row: 1 / span 2; /* Span across both rows */
      }

      .right {
        grid-column: 2; /* Right column */
        grid-row: 1; /* First row */
        margin-right: 10px;
        margin-top: 10px;
      }

      .middle {
        grid-column: 2; /* Right column */
        grid-row: 2; /* Second row */
        margin: 10px
        /* margin:35px -30px; */
        /* margin: -150px 0 0 10px; */
      }

      /* service form */

      div.service-form-container {
        display: flex;
        flex: 1 1 auto;
        width:100%;
        padding: 10px;
        margin: 5px;
        border-radius: 10px;
      }

      div.service-form-container div.s-container #serviceForm {
        display: flex;
        flex-direction: column;
        border: 1px solid #c7c7c7;
        border-radius: 5px;
        padding: 5px;
      }

      div.service-form-container div.s-container h1 {
        font-size: 1.5rem;
        text-align: center;
        margin: 5px;
        color: #f2cc20;
      }

      div.service-form-container div.s-container #serviceForm input,
      select {
        outline: none;
        border: 1px solid #c7c7c7;
        border-radius: 5px;
        font-size: 1rem;
        cursor: pointer;
        width: 90%;
        margin: 0 auto;
      }
      div.service-form-container div.s-container #serviceForm input:focus,
      select:focus {
        outline: 0;
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25); /* Bootstrap blue */
        border-color: #0d6efd; /* Bootstrap blue */
      }
      div.service-form-container
        div.s-container
        #serviceForm
        button[type="submit"] {
        margin: 5px auto;
        width: 90%;
        padding: 5px;
        border: none;
        outline: none;
        border-radius: 5px;
        font-size: 1rem;
        background-color: #0069d9;
        color: #ffffff;
      }
      div.service-form-container
        div.s-container
        #serviceForm
        button[type="submit"]:active {
        box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25); /* Bootstrap blue */
        background-color: #0056b3; /* Darker blue */
        border-color: #004085;
      }
      div.service-form-container div.s-container #serviceForm label {
        font-size: 1rem;
        margin: 10px 0 0 10px;
        font-weight: 600;
        color: #ffffff;
      }

      /* service typer form */
      div.service-type-forn-container h1 {
        font-size: 1.5rem;
        color: #f2cc20;
      }
      div.service-type-forn-container div.st-container #serviceTypeForm {
        display: grid;
        grid-template-columns: 1fr 1fr;
        grid-template-rows: 1fr 1fr;
        gap: 5px;
        margin: 0 auto;
        width: 100%;
      }

      div.service-type-forn-container
        div.st-container
        #serviceTypeForm
        fieldset {
        border: 1px solid #c7c7c7;
        border-radius: 5px;
        padding: 5px;
        margin: 10px;
      }
      div.service-type-forn-container
        div.st-container
        #serviceTypeForm
        fieldset
        legend {
        font-size: 1rem;
        font-weight: bold;
        padding: 5px;
        background-color: #0d6efd;
        color: #ffffff;
        border-radius: 5px;
        height: fit-content;
      }

      /* Style for the checkbox */
      div.service-type-forn-container
        div.st-container
        #serviceTypeForm
        input[type="checkbox"] {
        width: 24px;
        height: 24px;
        outline: none;
        border: 2px solid #c7c7c7;
        border-radius: 5px; /* Rounded corners */
        appearance: none; /* Removes default checkbox styling */
        background-color: #fff; /* White background */
        cursor: pointer; /* Pointer cursor on hover */
        position: relative; /* Necessary for positioning the checkmark */
        transition: all 0.2s ease; /* Smooth transition */
      }

      /* When the checkbox is checked */
      div.service-type-forn-container
        div.st-container
        #serviceTypeForm
        input[type="checkbox"]:checked {
        background-color: #0d6efd; /* Background color when checked */
        border-color: #0d6efd; /* Border color when checked */
        box-shadow: 0 0 0 4px rgba(13, 110, 253, 0.25); /* Optional glow effect */
      }

      /* When the checkbox is hovered */
      div.service-type-forn-container
        div.st-container
        #serviceTypeForm
        input[type="checkbox"]:hover {
        border-color: #0d6efd; /* Border color on hover */
      }

      /* Adding the checkmark (‚úî) when checked */
      div.service-type-forn-container
        div.st-container
        #serviceTypeForm
        input[type="checkbox"]:checked::before {
        content: "\f00c"; /* Checkmark character */
        font-family: "Font Awesome 6 Free", sans-serif; /* Ensure you're using Font Awesome */
        font-weight: 900;
        position: absolute;
        top: 50%; /* Center vertically */
        left: 50%; /* Center horizontally */
        transform: translate(-50%, -50%); /* Center the checkmark perfectly */
        font-size: 1rem;
        color: white; /* Color of the checkmark */
      }

      /* Optional: Add some padding inside the checkbox to make space for the checkmark */
      div.service-type-forn-container
        div.st-container
        #serviceTypeForm
        input[type="checkbox"] {
        padding: 4px; /* Adds padding on the left side for checkmark */
      }
      div.service-type-forn-container
        div.st-container
        #serviceTypeForm
        .checkbox-label {
        font-size: 1rem;
        margin: 0;
        cursor: pointer; /* Optional: makes label clickable */
      }
      div.service-type-forn-container
        div.st-container
        #serviceTypeForm
        .checkbox-label
        .english-text {
        font-size: 1.2rem; /* Smaller font size for English text */
        color: #ffffff;
        font-weight: 500;
      }
      div.service-type-forn-container
        div.st-container
        #serviceTypeForm
        .checkbox-label
        .arabic-text {
        font-size: 1.5rem; /* Smaller font size for Arabic text */
        margin: 2.5px;
        color: #ffffff;
        font-weight: 400;
      }

      /* table-wrapper */
      /* Table wrapper styling */
      div.table-wrapper {
        width: 100%; /* Full width */
        height: 500px; /* adjusted to handle the image repeatation */
        padding: 20px; /* Add space around the table */
      }
      div.table-wrapper h1 {
        font-size: 1.5rem;
        color: #f2cc20;
      }
      /* Table container inside the wrapper */
      div.table-wrapper div.table-container {
        width: 94.3%; /* Ensure the table takes up full container width */
        border: 2px solid #c7c7c7; /* Optional border around the table container */
        border-radius: 10px; /* Rounded corners for container */
        background-color: #f5f5f5;
        border-radius: 5px;
        max-height: 50%;
        overflow-y: scroll;
      }
      /* Table styling */
      div.table-wrapper div.table-container table {
        width: 100%; /* Table takes full width */
        border-collapse: collapse; /* Collapse table borders for a cleaner look */
       
        margin: 0 20px 0 0; /* Remove margins for better layout control */
        border-radius: 5px;
      }

      /* Table header */
      div.table-wrapper div.table-container table th {
        background-color: #e0ac00; /* Light background for headers */
        padding: 10px; /* Add padding for space */
        text-align: center; /* Align header text to the left */
        font-weight: bold; /* Bold text for headers */
        color: #333; /* Darker color for header text */
        border-bottom: 2px solid #c7c7c7; /* Border below headers */
      }

      /* Table cells */
      div.table-wrapper div.table-container table td {
        padding: 10px 20px; /* Add padding to table cells */
        text-align: left; /* Align text inside cells */
        border: 1px solid #c7c7c9; /* Light border around cells */
      }
      div.table-wrapper div.table-container table tr:last-of-type {
        border-radius: 5px;
      }
      /* Table row hover effect */
      div.table-wrapper div.table-container table tr:hover {
        background-color: #c7c7c7; /* Light background on hover */
      }

      /* Optional: Styling for checkboxes inside table */
      div.table-wrapper div.table-container table td input[type="checkbox"] {
        margin-right: 10px; /* Space between checkbox and label */
        vertical-align: middle; /* Align checkbox vertically with the label */
      }
      /* fix viewport for small screens */
      @viewport {
        width: 1024px !important;
      }
    </style>
  </head>
  <body>
    <div class="flex-wrapper">
      <main class="master-container">
        <div class="container">
          <div class="service-form-container left">
            <div class="s-container">
              <h1>Machine Information</h1>
              <form id="serviceForm">
                <label for="dateService">Date Service:</label>
                <input
                  type="date"
                  id="dateService"
                  autocomplete="off"
                  name="dateService"
                  required
                />

                <label for="model">Model:</label>
                <input
                  type="text"
                  id="model"
                  autocomplete="off"
                  name="model"
                  placeholder="model"
                  required
                  readonly
                />

                <label for="plateCoNo">Plate / Code:</label>
                <select id="plateCoNo" name="plateCoNo" required>
                  <option value="">Select Code</option>
                  <!-- Code options will be populated dynamically -->
                </select>

                <label for="hourKM">Hour / K.M:</label>
                <input
                  type="text"
                  id="hourKM"
                  autocomplete="off"
                  placeholder="write here"
                  name="hourKM"
                  required
                />

                <label for="type">Type:</label>
                <input
                  type="text"
                  id="type"
                  autocomplete="off"
                  name="type"
                  placeholder="write here"
                  required
                  readonly
                />

                <label for="site">Site:</label>
                <input
                  type="text"
                  id="site"
                  name="site"
                  autocomplete="off"
                  placeholder="Enter site/location"
                  required
                />

                <label for="battery">Battery:</label>
                <input
                  type="text"
                  id="battery"
                  autocomplete="off"
                  name="battery"
                  placeholder="Enter battery details"
                />
                <!-- Battery is optional -->
                <br />
                <!--add a line break to separate inputs from submit-button-->
                <button type="submit">Submit</button>
              </form>
            </div>
          </div>

          <!-- service-type-form -->
          <div class="service-type-forn-container right">
            <h1>Service Types</h1>
            <div class="st-container">
              <form id="serviceTypeForm">
                <!-- Engine Service Section -->
                <fieldset class="engine-serv">
                  <legend>Engine Service</legend>
                  <div class="checkbox-label">
                    <input
                      type="checkbox"
                      id="oilFilter"
                      name="serviceTypes"
                      value="OIL FILTER"
                    />
                    <label for="oilFilter">
                      <span class="arabic-text">ŸÅŸÑÿ™ÿ± ÿ≤Ÿäÿ™</span>
                      <span class="english-text">OIL FILTER</span>
                    </label>
                  </div>
                  <div class="checkbox-label">
                    <input
                      type="checkbox"
                      id="fuelFilter"
                      name="serviceTypes"
                      value="FUEL FILTER"
                    />
                    <label for="fuelFilter">
                      <span class="arabic-text">ŸÅŸÑÿ™ÿ± ÿØŸäÿ≤ŸÑ</span>
                      <span class="english-text">FUEL FILTER</span>
                    </label>
                  </div>
                  <div class="checkbox-label">
                    <input
                      type="checkbox"
                      id="waterSep"
                      name="serviceTypes"
                      value="WATER SEP"
                    />
                    <label for="waterSep">
                      <span class="arabic-text">ŸÅŸÑÿ™ÿ± ÿ≥Ÿäÿ®ÿ± Ÿäÿ™ÿ±</span>
                      <span class="english-text">WATER SEP</span>
                    </label>
                  </div>
                  <div class="checkbox-label">
                    <input
                      type="checkbox"
                      id="engineOil"
                      name="serviceTypes"
                      value="ENGINE OIL"
                    />
                    <label for="engineOil">
                      <span class="arabic-text">ÿ≤Ÿäÿ™ ŸÖÿ≠ÿ±ŸÉ</span>
                      <span class="english-text">ENGINE OIL</span>
                    </label>
                  </div>
                </fieldset>

                <!-- Hyd.service section -->
                <fieldset class="hyd-service">
                  <legend>Hyd.service</legend>
                  <div class="checkbox-label">
                    <input
                      type="checkbox"
                      id="returnFilter"
                      name="serviceTypes"
                      value="RETURN FILTER"
                    />
                    <label for="returnFilter">
                      <span class="arabic-text">ŸÅŸÑÿ™ÿ± ŸáŸäÿØÿ±ŸàŸÑŸäŸÉ</span>
                      <span class="english-text">RETURN FILTER</span>
                    </label>
                  </div>
                  <div class="checkbox-label">
                    <input
                      type="checkbox"
                      id="strainer"
                      name="serviceTypes"
                      value="STRAINER"
                    />
                    <label for="strainer">
                      <span class="arabic-text">ŸÅŸÑÿ™ÿ± ŸáŸäÿØÿ±ŸàŸÑŸäŸÉ</span>
                      <span class="english-text">STRAINER</span>
                    </label>
                  </div>
                  <div class="checkbox-label">
                    <input
                      type="checkbox"
                      id="drainFilter"
                      name="serviceTypes"
                      value="DRAIN FILTER"
                    />
                    <label for="drainFilter">
                      <span class="arabic-text">ŸÅŸÑÿ™ÿ± ŸáŸäÿØÿ±ŸàŸÑŸäŸÉ</span>
                      <span class="english-text">DRAIN FILTER</span>
                    </label>
                  </div>
                  <div class="checkbox-label">
                    <input
                      type="checkbox"
                      id="lineFilter"
                      name="serviceTypes"
                      value="LINE FILTER"
                    />
                    <label for="lineFilter">
                      <span class="arabic-text">ŸÅŸÑÿ™ÿ± ŸáŸäÿØÿ±ŸàŸÑŸäŸÉ</span>
                      <span class="english-text">LINE FILTER</span>
                    </label>
                  </div>
                  <div class="checkbox-label">
                    <input
                      type="checkbox"
                      id="hydOil"
                      name="serviceTypes"
                      value="HYD.OIL"
                    />
                    <label for="hydOil">
                      <span class="arabic-text">ÿ≤Ÿäÿ™ ŸáŸäÿØÿ±ŸàŸÑŸäŸÉ</span>
                      <span class="english-text">HYD.OIL</span>
                    </label>
                  </div>
                </fieldset>

                <!-- Transmission service section -->
                <fieldset class="transmission-serv">
                  <legend>Transmission Service</legend>
                  <div class="checkbox-label">
                    <input
                      type="checkbox"
                      id="transmissionOil"
                      name="serviceTypes"
                      value="TRANSMISSION OIL"
                    />
                    <label for="transmissionOil">
                      <span class="arabic-text">ÿ≤Ÿäÿ™ ÿ¨Ÿäÿ±</span>
                      <span class="english-text">TRANSMISSION OIL</span>
                    </label>
                  </div>
                  <div class="checkbox-label">
                    <input
                      type="checkbox"
                      id="transmissionFilter"
                      name="serviceTypes"
                      value="TRANSMISSION FILTER"
                    />
                    <label for="transmissionFilter">
                      <span class="arabic-text">ŸÅŸÑÿ™ÿ± ÿ¨Ÿäÿ±</span>
                      <span class="english-text">TRANSMISSION FILTER</span>
                    </label>
                  </div>
                </fieldset>
                <!-- other services  -->
                <fieldset class="other-serv">
                  <legend>Others</legend>
                  <div class="checkbox-label">
                    <input
                      type="checkbox"
                      id="finalDriveOil"
                      name="serviceTypes"
                      value="FINAL DRIVE OIL"
                    />
                    <label for="finalDriveOil">
                      <span class="arabic-text">ÿ≤Ÿäÿ™ ÿØŸäŸÅÿ±ŸäŸÜÿ≥</span>
                      <span class="english-text">FINAL DRIVE OIL</span>
                    </label>
                  </div>
                  <div class="checkbox-label">
                    <input
                      type="checkbox"
                      id="swingMotorOil"
                      name="serviceTypes"
                      value="SWING MOTOR OIL"
                    />
                    <label for="swingMotorOil">
                      <span class="arabic-text">ÿ≤Ÿäÿ™ ÿØŸàÿ±ÿßŸÜ</span>
                      <span class="english-text">SWING MOTOR OIL</span>
                    </label>
                  </div>
                  <div class="checkbox-label">
                    <input
                      type="checkbox"
                      id="airFilter"
                      name="serviceTypes"
                      value="AIR FILTER"
                    />
                    <label for="airFilter">
                      <span class="arabic-text">ŸÅŸÑÿ™ÿ± ŸáŸàÿßÿ°</span>
                      <span class="english-text">AIR FILTER</span>
                    </label>
                  </div>
                </fieldset>
              </form>
            </div>
          </div>
          <!-- table-wrapper -->
          <div class="table-wrapper middle">
            <!-- Content for Middle Div -->
            <h1>SERVICE RECORD</h1>
            <div class="table-container" id="tableContainer">
              <!-- dynamic table -->
            </div>
          </div>
        </div>
      </main>
    </div>
    <!-- hidden elements -->
    <input type="text" id="colF" style="display: none" />
    <input type="text" id="colG" style="display: none" />
    <input type="text" id="colH" style="display: none" />
    <input type="text" id="colI" style="display: none" />
    <input type="text" id="colJ" style="display: none" />
    <input type="text" id="colK" style="display: none" />
    <input type="text" id="colL" style="display: none" />
    <input type="text" id="colM" style="display: none" />
    <input type="text" id="colT" style="display: none" />
    <input type="text" id="colU" style="display: none" />

    <!-- Functions -->
    <script>
      async function fetchMachinesData() {
        try {
          const data = await google.script.run
            .withSuccessHandler((data) => {
              populateCoNoDropdown(data);
              localStorage.setItem("machinesData", JSON.stringify(data));
            })
            .fetchMachinesData();
        } catch (error) {
          console.error("Error fetching machines data:", error);
        }
      }
      function fetchData(headers, tbody, selectedValue) {
        console.log("selectedValue----" + selectedValue);
        google.script.run
          .withSuccessHandler((data) => {
            console.log("Data received:", data); // This will log the JSON string returned
            processReceivedData(JSON.parse(data), tbody, headers); // Pass the data to another function to process
          })
          .withFailureHandler((error) => {
            console.error("Error fetching data:", error);
          })
          .fetchRowsByPlateSelection(selectedValue);
      }
      function processReceivedData(data, tbody, headers) {
        // Populate rows

        data.forEach((row) => {
          const tr = document.createElement("tr");

          headers.forEach((header) => {
            const td = document.createElement("td");
            td.textContent = row[header];
            tr.appendChild(td);
          });

          tbody.appendChild(tr);
        });
      }
      function populateCoNoDropdown(machines) {
        const plateCoNoSelect = document.getElementById("plateCoNo");

        plateCoNoSelect.innerHTML = '<option value="">Select Code</option>';

        machines.forEach((machine) => {
          const option = document.createElement("option");
          option.value = machine.code;
          option.textContent = machine.code;
          plateCoNoSelect.appendChild(option);
        });
        console.log("Dropdown populated with Codes.");
      }

      function updateType() {
        const engineOil = document.getElementById("engineOil").checked;
        const oilFilter = document.getElementById("oilFilter").checked;
        const airFilter = document.getElementById("airFilter").checked;
        const hydOil = document.getElementById("hydOil").checked;
        const returnFilter = document.getElementById("returnFilter").checked;
        const transmissionOil =
          document.getElementById("transmissionOil").checked;
        const transmissionFilter =
          document.getElementById("transmissionFilter").checked;

        let type = "";

        if (engineOil) {
          type += "E.O";
        }

        if (oilFilter && engineOil) {
          type += (type ? "+" : "") + "F";
        }

        if (airFilter) {
          type = "A.F";
        }

        if (hydOil) {
          type = "H.O";
        }

        if (returnFilter && hydOil) {
          type += (type ? "+" : "") + "F";
        }

        if (transmissionOil) {
          type = "T.O";
        }

        if (transmissionFilter && transmissionOil) {
          type += (type ? "+" : "") + "F";
        }

        const batteryValue = document.getElementById("battery").value.trim();
        if (batteryValue) {
          type += (type ? "+" : "") + "Battery";
        }

        document.getElementById("type").value = type;
      }

      document
        .querySelectorAll('#serviceTypeForm input[type="checkbox"]')
        .forEach((checkbox) => {
          checkbox.addEventListener("change", () => {
            updateType();
          });
        });

      document.getElementById("battery").addEventListener("input", () => {
        updateType();
      });

      window.onload = fetchMachinesData;

      document
        .getElementById("serviceForm")
        .addEventListener("submit", function (event) {
          event.preventDefault();

          const formData = new FormData(event.target);
          const serviceTypes = [];

          document
            .querySelectorAll('#serviceTypeForm input[type="checkbox"]:checked')
            .forEach((checkbox) => {
              serviceTypes.push(checkbox.value);
            });

          const data = {
            dateService: formData.get("dateService"),
            model: formData.get("model"),
            plateCoNo: formData.get("plateCoNo"),
            hourKM: formData.get("hourKM"),
            type: formData.get("type"),
            site: formData.get("site"),
            battery: formData.get("battery"),
            serviceTypes: serviceTypes,
          };

          console.log("Form data to be sent:", data);

          if (
            !data.dateService ||
            !data.model ||
            !data.plateCoNo ||
            !data.hourKM ||
            !data.type ||
            !data.site
          ) {
            console.error("Validation failed. One or more fields are missing.");
            return;
          }

          google.script.run
            .withSuccessHandler((data) => {
              event.target.reset();

              document
                .querySelectorAll('#serviceTypeForm input[type="checkbox"]')
                .forEach((checkbox) => {
                  checkbox.checked = false;
                });
              document.getElementById("type").value = "";

              window.alert("Data successfully submited üÜó");
            })
            .saveServiceData(data);

          google.script.run.withFailureHandler((err) => {
            window.alert("Unknown error occured!!!", err);
          });
        });

      //   handle viewport
      (function () {
        const desktopWidth = 1200; // Fixed desktop width
        const availableHeight = window.innerHeight;
        const viewport = document.querySelector('meta[name="viewport"]');
        if (window.innerWidth < desktopWidth) {
          viewport.setAttribute(
            "content",
            `width=${desktopWidth}, initial-scale=${
              window.innerWidth / desktopWidth
            }, user-scalable=no`
          );
        } else {
          viewport.setAttribute(
            "content",
            "width=device-width, initial-scale=1, user-scalable=no"
          );
        }
        // Adjust the body and HTML to fit content
        document.documentElement.style.height = `${availableHeight}px`;
        // document.documentElement.style.overflow = "hidden";
        document.body.style.height = `${availableHeight}px`;
      })();

      // This script assumes the DOM is already loaded since it runs at the end of the document.

      const dropdown = document.getElementById("plateCoNo");

      dropdown.addEventListener("change", async () => {
        const selectedValue = dropdown.value;

        // Clear existing table data
        // tableBody.innerHTML = "";

        if (selectedValue) {
          createTable(selectedValue);

          // fill model field
          const modelInput = document.getElementById("model");
          const machines =
            JSON.parse(localStorage.getItem("machinesData")) || [];
          const selectedMachine = machines.find(
            (machine) => machine.code === selectedValue
          );

          if (selectedMachine) {
            modelInput.value = selectedMachine.model;
          } else {
            modelInput.value = "";
          }
        } else {
          tableBody.innerHTML =
            "<tr><td colspan='3'>No data available</td></tr>";
        }
      });
      function createTable(selectedValue) {
        const tableContainer = document.getElementById("tableContainer");

        // Clear existing content in the container
        tableContainer.innerHTML = "";

        // Create a wrapper div for the table with fixed height
        const wrapper = document.createElement("div");
        wrapper.style.maxHeight = "530px";
        wrapper.style.overflowY = "auto"; // Enable vertical scrolling
        wrapper.style.border = "1px solid #ccc"; // Optional: Add border for clarity
        // Create the table element
        const table = document.createElement("table");
        table.border = "1";
        table.style.width = "100%";
        table.style.borderCollapse = "collapse"; // Optional: Cleaner table look

        // Add the table header
        const thead = document.createElement("thead");
        const headerRow = document.createElement("tr");

        // Define headers
        const headers = ["DATE", "MODEL", "CONO", "HOUR", "TYPE"];
        headers.forEach((header) => {
          const th = document.createElement("th");
          th.textContent = header;
          th.style.position = "sticky"; // Make header sticky
          th.style.top = "0"; // Fix it to the top
          th.style.backgroundColor = "#f2cc20"; // Optional: Header background color
          th.style.zIndex = "1"; // Ensure header stays above content
          headerRow.appendChild(th);
        });

        thead.appendChild(headerRow);
        table.appendChild(thead);

        // Add the table body
        const tbody = document.createElement("tbody");

        const data = fetchData(headers, tbody, selectedValue);

        // Filter the rows where column C (index 2) matches the value, excluding the header row

        table.appendChild(tbody);

        // Append the table to the wrapper
        wrapper.appendChild(table);

        // Append the wrapper to the container
        tableContainer.appendChild(wrapper);
      }
    </script>
  </body>
</html>
