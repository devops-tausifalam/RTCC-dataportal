<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=1024" />
    <title>Service Record Form</title>
    <style type="text/css">
        body {
            margin: 0;
            padding: 0;
            width: 100vw;
            max-width: 100%;
            font-family: Arial, Helvetica, sans-serif;
        }
        main {
          display: flex;
          flex: 1 1;
        }
        button {
            display: inline-block;
            font-weight: 400;
            color: #fff;
            background-color: #007bff;
            border: 1px solid #007bff;
            width: 100%;
            max-width: 200px;
            height: 28px;
            padding: 4px 8px;
            font-size: 0.9rem;
            font-weight: 400;
            line-height: 1.5;
            text-align: center;
            text-decoration: none;
            vertical-align: middle;
            cursor: pointer;
            border-radius: 0.25rem;
            transition: background-color 0.15s ease-in-out,
                border-color 0.15s ease-in-out;
        }

        button:hover {
            background-color: #0056b3;
            border-color: #0056b3;
            color: #fff;
        }

        label {
            display: inline-block;
            margin-bottom: 0.5rem;
            font-weight: bold;
            font-size: 1rem;
        }

        input[type="text"],
        input[type="date"],
        select {
            display: block;
            width: 100%;
            max-width: 200px;
            height: 28px;
            padding: 4px 8px;
            font-size: 0.9rem;
            font-weight: 400;
            line-height: 1.5;
            color: #495057;
            background-color: #fff;
            background-clip: padding-box;
            border: 1px solid #ced4da;
            border-radius: 0.25rem;
            transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }

        input:focus,
        select:focus {
            color: #495057;
            background-color: #fff;
            border-color: #80bdff;
            outline: 0;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }

        h1 {
            text-align: center;
        }

        div.content-wrapper {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            padding: 1rem;
        }

        div.global-column-container {
            display: flex;
            flex-direction: row;
            width: 100%;
            justify-content: space-between;
        }

        div.column {
            flex: 1;
            margin: 0 20px;
        }

        div.column1 {
            width: 450px;
            max-width: 450px;
        }

        div.column1,
        div.column2 {
            display: flex;
            flex-direction: column;
        }

        div.column2 #serviceTypeForm {
            display: flex;
            flex-direction: column;
            margin: 0 2rem;
            height: 360px;
        }

        .checkbox-label {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: flex-start;
            margin-bottom: 0.5rem;
            font-size: 0.9rem; /* Reduced font size for overall checkbox */
            font-weight: bold;
            gap: 0.5rem; /* Space between elements */
            white-space: nowrap;
        }

        .checkbox-label .english-text {
            font-size: 0.8rem; /* Smaller font size for English text */
            color: #222;
        }

        .checkbox-label .arabic-text {
            font-size: 0.9rem; /* Smaller font size for Arabic text */
            color: #555;
        }

        .checkbox-label input[type="checkbox"] {
            appearance: none;
            width: 1.2rem;
            height: 1.2rem;
            border: 2px solid #007bff;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }

        .checkbox-label input[type="checkbox"]:checked {
            background-color: #007bff;
            border-color: #0056b3;
            color: #fff;
        }

        .checkbox-label input[type="checkbox"]:checked::before {
            content: "✔";
            font-size: 0.9rem;
            color: #fff;
        }

        div.table-wrapper {
            display: block;
            width: 100%;
            overflow-x: auto;
            margin-top: 1rem;
            padding: 1rem;
        }

        div.table-wrapper table {
            width: 100%;
            border-collapse: collapse;
        }

        div.table-wrapper th,
        td {
            border: 1px solid #ddd;
            padding: 12px 20px;
            text-align: left;
            font-size: 1rem;
        }

        div.table-wrapper th {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #343a40;
            padding: 12px 20px;
            text-align: center;
        }

        div.table-wrapper td {
            background-color: #fff;
            color: #495057;
            padding: 12px 20px;
            text-align: center;
        }

        div.table-wrapper tr:hover {
            background-color: #f1f1f1;
        }

        div.table-wrapper table thead {
            position: sticky;
            top: 0;
            background-color: #007bff;
            z-index: 1;
            color: #fff;
        }

        div.table-wrapper th:nth-child(1),
        td:nth-child(1) {
            width: 15%;
        }

        th:nth-child(2),
        td:nth-child(2) {
            width: 15%;
        }

        th:nth-child(3),
        td:nth-child(3) {
            width: 15%;
        }

        th:nth-child(4),
        td:nth-child(4) {
            width: 10%;
        }

        th:nth-child(5),
        td:nth-child(5) {
            width: 15%;
        }

        div.table-wrapper th,
        div.table-wrapper td {
            text-overflow: ellipsis;
            overflow: hidden;
            white-space: nowrap;
        }

        fieldset {
            margin: 10px auto;
            border: 1px solid #8a8a8a;
            width: 100%;
        }

        fieldset legend {
            font-size: 1.5rem;
            font-weight: 500;
            font-style: italic;
            color: red;
        }
    </style>
</head>

<body>
  <main>
    <div class="content-wrapper">
      <div class="global-column-container">
          <!-- main-form -->
          <div class="column1 column">
              <h1>Machine Information</h1>
              <form id="serviceForm">
                  <label for="dateService">Date Service:</label>
                  <input type="date" id="dateService" name="dateService" required />

                  <label for="model">Model:</label>
                  <input type="text" id="model" name="model" required readonly />

                  <label for="plateCoNo">Plate / Code:</label>
                  <select id="plateCoNo" name="plateCoNo" required>
                      <option value="">Select Code</option>
                      <!-- Code options will be populated dynamically -->
                  </select>

                  <label for="hourKM">Hour / K.M:</label>
                  <input type="text" id="hourKM" name="hourKM" required />

                  <label for="type">Type:</label>
                  <input type="text" id="type" name="type" required readonly />

                  <label for="site">Site:</label>
                  <input
                      type="text"
                      id="site"
                      name="site"
                      placeholder="Enter site/location"
                      required
                  />

                  <label for="battery">Battery:</label>
                  <input
                      type="text"
                      id="battery"
                      name="battery"
                      placeholder="Enter battery details"
                  />
                  <!-- Battery is optional -->
                  <br />
                  <!--add a line break to separate inputs from submit-button-->
                  <button type="submit">Submit</button>
              </form>
          </div>

          <div class="column2 column">
              <h1>Service Types</h1>
              <form id="serviceTypeForm">
                  <!-- Engine Service Section -->
                  <fieldset class="engine-serv">
                      <legend>Engine Service</legend>
                      <div class="checkbox-label">
                          <input
                              type="checkbox"
                              id="oilFilter"
                              name="serviceTypes"
                              value="OIL FILTER"
                          />
                          <label for="oilFilter">
                              <span class="arabic-text">فلتر زيت</span>
                              <span class="english-text">OIL FILTER</span>
                          </label>
                      </div>
                      <div class="checkbox-label">
                          <input
                              type="checkbox"
                              id="fuelFilter"
                              name="serviceTypes"
                              value="FUEL FILTER"
                          />
                          <label for="fuelFilter">
                              <span class="arabic-text">فلتر ديزل</span>
                              <span class="english-text">FUEL FILTER</span>
                          </label>
                      </div>
                      <div class="checkbox-label">
                          <input
                              type="checkbox"
                              id="waterSep"
                              name="serviceTypes"
                              value="WATER SEP"
                          />
                          <label for="waterSep">
                              <span class="arabic-text">فلتر سيبر يتر</span>
                              <span class="english-text">WATER SEP</span>
                          </label>
                      </div>
                      <div class="checkbox-label">
                          <input
                              type="checkbox"
                              id="engineOil"
                              name="serviceTypes"
                              value="ENGINE OIL"
                          />
                          <label for="engineOil">
                              <span class="arabic-text">زيت محرك</span>
                              <span class="english-text">ENGINE OIL</span>
                          </label>
                      </div>
                  </fieldset>

                  <!-- Hyd.service section -->
                  <fieldset class="hyd-service">
                      <legend>Hyd.service</legend>
                      <div class="checkbox-label">
                          <input
                              type="checkbox"
                              id="returnFilter"
                              name="serviceTypes"
                              value="RETURN FILTER"
                          />
                          <label for="returnFilter">
                              <span class="arabic-text">فلتر هيدروليك</span>
                              <span class="english-text">RETURN FILTER</span>
                          </label>
                      </div>
                      <div class="checkbox-label">
                          <input
                              type="checkbox"
                              id="strainer"
                              name="serviceTypes"
                              value="STRAINER"
                          />
                          <label for="strainer">
                              <span class="arabic-text">فلتر هيدروليك</span>
                              <span class="english-text">STRAINER</span>
                          </label>
                      </div>
                      <div class="checkbox-label">
                          <input
                              type="checkbox"
                              id="drainFilter"
                              name="serviceTypes"
                              value="DRAIN FILTER"
                          />
                          <label for="drainFilter">
                              <span class="arabic-text">فلتر هيدروليك</span>
                              <span class="english-text">DRAIN FILTER</span>
                          </label>
                      </div>
                      <div class="checkbox-label">
                          <input
                              type="checkbox"
                              id="lineFilter"
                              name="serviceTypes"
                              value="LINE FILTER"
                          />
                          <label for="lineFilter">
                              <span class="arabic-text">فلتر هيدروليك</span>
                              <span class="english-text">LINE FILTER</span>
                          </label>
                      </div>
                      <div class="checkbox-label">
                          <input
                              type="checkbox"
                              id="hydOil"
                              name="serviceTypes"
                              value="HYD.OIL"
                          />
                          <label for="hydOil">
                              <span class="arabic-text">زيت هيدروليك</span>
                              <span class="english-text">HYD.OIL</span>
                          </label>
                      </div>
                  </fieldset>

                  <!-- Transmission service section -->
                  <fieldset class="transmission-serv">
                      <legend>Transmission Service</legend>
                      <div class="checkbox-label">
                          <input
                              type="checkbox"
                              id="transmissionOil"
                              name="serviceTypes"
                              value="TRANSMISSION OIL"
                          />
                          <label for="transmissionOil">
                              <span class="arabic-text">زيت جير</span>
                              <span class="english-text">TRANSMISSION OIL</span>
                          </label>
                      </div>
                      <div class="checkbox-label">
                          <input
                              type="checkbox"
                              id="transmissionFilter"
                              name="serviceTypes"
                              value="TRANSMISSION FILTER"
                          />
                          <label for="transmissionFilter">
                              <span class="arabic-text">فلتر جير</span>
                              <span class="english-text">TRANSMISSION FILTER</span>
                          </label>
                      </div>
                  </fieldset>
                  <!-- other services  -->
                  <fieldset class="other-serv">
                      <legend>Others</legend>
                      <div class="checkbox-label">
                          <input
                              type="checkbox"
                              id="finalDriveOil"
                              name="serviceTypes"
                              value="FINAL DRIVE OIL"
                          />
                          <label for="finalDriveOil">
                              <span class="arabic-text">زيت ديفرينس</span>
                              <span class="english-text">FINAL DRIVE OIL</span>
                          </label>
                      </div>
                      <div class="checkbox-label">
                          <input
                              type="checkbox"
                              id="swingMotorOil"
                              name="serviceTypes"
                              value="SWING MOTOR OIL"
                          />
                          <label for="swingMotorOil">
                              <span class="arabic-text">زيت دوران</span>
                              <span class="english-text">SWING MOTOR OIL</span>
                          </label>
                      </div>
                      <div class="checkbox-label">
                          <input
                              type="checkbox"
                              id="airFilter"
                              name="serviceTypes"
                              value="AIR FILTER"
                          />
                          <label for="airFilter">
                              <span class="arabic-text">فلتر هواء</span>
                              <span class="english-text">AIR FILTER</span>
                          </label>
                      </div>
                  </fieldset>
              </form>
          </div>

          <div class="table-container column">
              <div class="table-wrapper">
                  <h1>SERVICE RECORD</h1>
                  <table>
                      <tr>
                          <th>DATE</th>
                          <th>MODEL</th>
                          <th>CO.NO</th>
                          <th>HOUR</th>
                          <th>TYPE</th>
                      </tr>
                      <tr>
                          <td></td>
                          <td></td>
                          <td></td>
                          <td></td>
                          <td></td>
                      </tr>
                      <tr>
                          <td></td>
                          <td></td>
                          <td></td>
                          <td></td>
                          <td></td>
                      </tr>
                      <tr>
                          <td></td>
                          <td></td>
                          <td></td>
                          <td></td>
                          <td></td>
                      </tr>
                      <tr>
                          <td></td>
                          <td></td>
                          <td></td>
                          <td></td>
                          <td></td>
                      </tr>
                      <tr>
                          <td></td>
                          <td></td>
                          <td></td>
                          <td></td>
                          <td></td>
                      </tr>
                      <tr>
                          <td></td>
                          <td></td>
                          <td></td>
                          <td></td>
                          <td></td>
                      </tr>
                      <tr>
                          <td></td>
                          <td></td>
                          <td></td>
                          <td></td>
                          <td></td>
                      </tr>
                      <tr>
                          <td></td>
                          <td></td>
                          <td></td>
                          <td></td>
                          <td></td>
                      </tr>
                      <tr>
                          <td></td>
                          <td></td>
                          <td></td>
                          <td></td>
                          <td></td>
                      </tr>
                      <tr>
                          <td></td>
                          <td></td>
                          <td></td>
                          <td></td>
                          <td></td>
                      </tr>
                  </table>
              </div>
          </div>
      </div>
  </div>
  </main>
    <script>
        async function fetchMachinesData() {
            try {
                const data = await google.script.run
                    .withSuccessHandler((data) => {
                        populateCoNoDropdown(data);
                        localStorage.setItem("machinesData", JSON.stringify(data));
                    })
                    .fetchMachinesData();
            } catch (error) {
                console.error("Error fetching machines data:", error);
            }
        }

        function populateCoNoDropdown(machines) {
            const plateCoNoSelect = document.getElementById("plateCoNo");

            plateCoNoSelect.innerHTML = '<option value="">Select Code</option>';

            machines.forEach((machine) => {
                const option = document.createElement("option");
                option.value = machine.code;
                option.textContent = machine.code;
                plateCoNoSelect.appendChild(option);
            });
            console.log("Dropdown populated with Codes.");
        }

        document
            .getElementById("plateCoNo")
            .addEventListener("change", function () {
                const selectedCode = this.value;
                const modelInput = document.getElementById("model");

                if (!selectedCode) {
                    modelInput.value = "";
                    return;
                }

                const machines =
                    JSON.parse(localStorage.getItem("machinesData")) || [];
                const selectedMachine = machines.find(
                    (machine) => machine.code === selectedCode
                );

                if (selectedMachine) {
                    modelInput.value = selectedMachine.model;
                } else {
                    modelInput.value = "";
                }
            });

        function updateType() {
            const engineOil = document.getElementById("engineOil").checked;
            const oilFilter = document.getElementById("oilFilter").checked;
            const airFilter = document.getElementById("airFilter").checked;
            const hydOil = document.getElementById("hydOil").checked;
            const returnFilter = document.getElementById("returnFilter").checked;
            const transmissionOil =
                document.getElementById("transmissionOil").checked;
            const transmissionFilter =
                document.getElementById("transmissionFilter").checked;

            let type = "";

            if (engineOil) {
                type += "E.O";
            }

            if (oilFilter && engineOil) {
                type += (type ? "+" : "") + "F";
            }

            if (airFilter) {
                type = "A.F";
            }

            if (hydOil) {
                type = "H.O";
            }

            if (returnFilter && hydOil) {
                type += (type ? "+" : "") + "F";
            }

            if (transmissionOil) {
                type = "T.O";
            }

            if (transmissionFilter && transmissionOil) {
                type += (type ? "+" : "") + "F";
            }

            const batteryValue = document.getElementById("battery").value.trim();
            if (batteryValue) {
                type += (type ? "+" : "") + "Battery";
            }

            document.getElementById("type").value = type;
        }

        document
            .querySelectorAll('#serviceTypeForm input[type="checkbox"]')
            .forEach((checkbox) => {
                checkbox.addEventListener("change", () => {
                    updateType();
                });
            });

        document.getElementById("battery").addEventListener("input", () => {
            updateType();
        });

        window.onload = fetchMachinesData;

        document
            .getElementById("serviceForm")
            .addEventListener("submit", function (event) {
                event.preventDefault();

                const formData = new FormData(event.target);
                const serviceTypes = [];

                document
                    .querySelectorAll('#serviceTypeForm input[type="checkbox"]:checked')
                    .forEach((checkbox) => {
                        serviceTypes.push(checkbox.value);
                    });

                const data = {
                    dateService: formData.get("dateService"),
                    model: formData.get("model"),
                    plateCoNo: formData.get("plateCoNo"),
                    hourKM: formData.get("hourKM"),
                    type: formData.get("type"),
                    site: formData.get("site"),
                    battery: formData.get("battery"),
                    serviceTypes: serviceTypes,
                };

                console.log("Form data to be sent:", data);

                if (
                    !data.dateService ||
                    !data.model ||
                    !data.plateCoNo ||
                    !data.hourKM ||
                    !data.type ||
                    !data.site
                ) {
                    console.error("Validation failed. One or more fields are missing.");
                    return;
                }

                google.script.run
                    .withSuccessHandler((response) => {
                        console.log("Data saved successfully:", response);
                        event.target.reset();

                        document
                            .querySelectorAll('#serviceTypeForm input[type="checkbox"]')
                            .forEach((checkbox) => {
                                checkbox.checked = false;
                            });
                        document.getElementById("type").value = "";
                    })
                    .saveServiceData(data);
            });
    </script>

    <input type="text" id="colF" style="display: none" />
    <input type="text" id="colG" style="display: none" />
    <input type="text" id="colH" style="display: none" />
    <input type="text" id="colI" style="display: none" />
    <input type="text" id="colJ" style="display: none" />
    <input type="text" id="colK" style="display: none" />
    <input type="text" id="colL" style="display: none" />
    <input type="text" id="colM" style="display: none" />
    <input type="text" id="colT" style="display: none" />
    <input type="text" id="colU" style="display: none" />
</body>

</html>
